<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chatroom</title>
	<script src="/socket.io/socket.io.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="/style.css">
</head>

<body>

	<div class="container">
		<div id="chat-box" class="mt-3">
			<!-- Messages will be appended here -->
		</div>

		<form id="message-form" class="mt-3">
			<input type="text" id="message-input" class="form-control" placeholder="Type your message..." />
			<button type="submit" class="btn btn-primary mt-2">Send</button>
		</form>
	</div>

	<script>
		// Connect to the server
		const socket = io();

		const displayName = "<%= currentUser.displayName %>"; // Get displayName from server-side EJS

		// Emit message to the server when a user joins
		socket.emit('user-joined', displayName);

		// Listen for chat messages
		socket.on('chat-message', (data) => {
			const chatBox = document.getElementById('chat-box');
			const messageElement = document.createElement('div');
			messageElement.textContent = data.message;
			chatBox.appendChild(messageElement);
			chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the latest message
		});

		// Listen for user join message
		socket.on('user-joined', (message) => {
			const chatBox = document.getElementById('chat-box');
			const messageElement = document.createElement('div');
			messageElement.textContent = message;
			chatBox.appendChild(messageElement);
		});

		// Handle sending messages
		document.getElementById('message-form').addEventListener('submit', (e) => {
			e.preventDefault();
			const messageInput = document.getElementById('message-input');
			const message = messageInput.value;
			socket.emit('send-message', message); // Emit the message to the server
			messageInput.value = ''; // Clear the input
		});
	</script>

</body>

</html>